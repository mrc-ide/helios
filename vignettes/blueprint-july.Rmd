---
title: 'Update to "assessing far UVC interventions with an individual based infectious disease model"'
author:
  - Charlie Whittaker^[Imperial College London], Tom Brewer^[Imperial College London], Adam Howes^[Independent]
output: 
  bookdown::html_document2:
    fig_caption: yes
    number_sections: yes
pkgdown:
  as_is: true
vignette: >
  %\VignetteIndexEntry{blueprint}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
bibliography: REFERENCES.bib
editor_options: 
  markdown: 
    wrap: sentence
---

```{r, include = FALSE}
options(rmarkdown.html_vignette.check_title = FALSE)

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  dpi = 330,
  out.width = "90%"
)

```

```{r}
library(helios)
library(individual)
library(ggplot2)
library(dplyr, warn.conflicts = FALSE)
library(purrr)
theme_set(theme_minimal())
blueprint_colours <- colorRampPalette(c("#00AFFF", "#03113E"))(4)
exemplar_data <- readRDS("./exemplar_simulations.rds")
parameter_sweep_data <- readRDS("./parameter_sweep_data.rds")
```

# Overview

This document builds on [previous work](https://mrc-ide.github.io/helios/articles/blueprint.html) that introduced `helios`, an individual-based modelling framework for exploring the impact that installation of far UVC could have on the transmission and burden of respiratory infections.
In this document, we present a series of analyses evaluating the impact that installation of far UVC in non-household settings could have on the burden....

# Major Model Changes

Include relevant details about the model here, and changes from the first report:

## The Consistent Use of Data from the United States of America {#locations}

Add some subsections here about the data we now use.
Can basically copy the structure of the first report.

## Location-Specific Variability in "Riskiness"

Previously, we modelled differences in "riskiness" (i.e. how receptive to onwards transmission it is) between different Setting Types (schools, workplaces, leisure settings and households).
However, we made the simplifying assumption that all Locations with a particular Setting Type (e.g. all schools) had the same "riskiness", which is unrealistic.
We have now updated thte model to explicitly incorporate variation in "riskiness" between Locations belonging to the same Setting Type.
What follows below is a mathematical description of how this addition to the model works, how it was derived, and how we have parameterised this for the purposes of the new results presented in this report.

### Updating the Force of Infection to Include Location-Specific Variation in Riskiness/Receptivity to Transmission 

As a reminder, the previous version of the force of infection experienced by individual $i$ in Location $m$ at time $t$ was calculated as follows:

$$ \lambda_{i,j,m}(t) = \frac{\beta_{m} I_{j,m}(t)}{N_{j,m}} $$

where $I_m(t)$ are the number of infectious individuals in Location $j$ of Setting Type $m$ at time $t$ , $N_{j,m}$ are the total number of individuals visiting Location $j$ of Setting Type $m$ at time $t$ and $\beta_m$ is a Setting Type-specific (i.e. workplace, school, household, leisure-venue) transmissibility parameter that models **on average** how much transmission happens in a particular Setting Type (e.g. workplaces) compared to other Settings Types (e.g. schools).
The total force of infection $\lambda_T$ experienced across all Setting Types is then summed and forms the basis for calculating an individual's probability of infection during one time-step $t$:

$$ P(infection) = 1 - e^{- \lambda_{i,T}t}. $$

Previously, $\beta$ was specific to the Setting Type (i.e. it was different for schools, workplaces, households and leisure settings) but assumed to be the same same for every location belonging to a particular setting type - that is, all individual locations of a particular Setting Type (e.g. all schools) had the same $\beta$.
We have now relaxed this assumption.
The updated force of infection term is now the following:

$$ \lambda_{i,j,m}(t) = \frac{\beta_{j,m} I_{j,m}(t)}{N_{j,m}} $$

where:\
$$ \beta_{j,m} = \gamma\beta_{m} $$

and:

$$
\gamma \sim Lognormal(\mu_{log}, sd_{log})
$$

i.e. a draw from a Lognormal distribution.
$\gamma$ controls how much more or less risky a particular Location of a specific Setting Type is relative to the **average** for that Setting Type.
For example, $\gamma = 1$ is a setting which is as "risky" (or conducive to transmission) as the average location of that Setting Type.
$\gamma = 2$ would describe a setting that is twice as risky; $\gamma = 0.5$ would describe a setting that is half as risky etc.
Parameterisation and estimation of this parameter $\gamma$ is described further below.

The concentration of pathogen in the air is modelled via the ODE:

$$
\nu \frac{dC(t)}{dt} =  - QC - k_DC \nu + I\pi 
$$

where $v$ is the room volume, $C$ is the infective virus concentration, $t$ is time, $Q$ is the flow rate of air into and out of the room, $k_D$ is the natural decay constant, $I$ is the number of infectious individuals in the room, and $\pi$ is the per capita (infective) virus emission rate.
The closed-form solution to this equation is:

$$
C =  \frac{I\pi}{\alpha \nu}(1 - e^{-\alpha t}) 
$$

where:

$$
\alpha = \frac{Q}{\nu} + k_D
$$

is the number of equivalent air changes per hour.
As $t \rightarrow\infty$, we get the steady state solution, which is the following:

$$
C_{ss} =  \frac{I\pi}{\alpha \nu}
$$

We integrate this estimate of the concentration of infective virus in the room with the Wells-Riley equation, a simple and widely used model for the airbone transmission of infectious diseases.
The Wells-Riley model takes the following form:

$$
P_{i}(t) =  1 - e^{-r C_{ss}Bt}
$$

where $P_i$ is the probability a person becomes infected conditional on them spending time $t$ in a room with $C_{ss}$ concentration of infective virus, $B$ is the volume rate at which air is breathed in, and $r$ is risk parameter, the probability that a single inhaled infective virus will initiate an infection.

# Assessing how various far UVC parameters shape another outcome

We considered two pathogen archetypes, SARS-CoV-2 and influenza.
The properties of SARS-CoV-2 were as follows.
The properties of influenze were as follows.
For each pathogen archetype, we considered the effect of far UVC efficacy and far UVC coverage on another outcome.
We varied far UVC efficacy in the following range.
We varied far UVC coverage in the following range with the following settings.
The results are presented in Figure \@ref(fig:placeholder-1) and Figure \@ref(fig:placeholder-2).

```{r placeholder-1, fig.cap="(ref:placeholder-1)"}
data.frame(x = 1:5, y = 1:5) |>
  ggplot(aes(x = x, y = y)) +
  geom_point() +
  theme_minimal()
```

(ref:placeholder-1) Placeholder one.

```{r placeholder-2, fig.cap="(ref:placeholder-2)"}
data.frame(x = 1:5, y = 1:5) |>
  ggplot(aes(x = x, y = y)) +
  geom_point() +
  theme_minimal()
```

(ref:placeholder-2) Placeholder two.

# Bibliography {.unnumbered}
