---
title: 'Update to "assessing far UVC interventions with an individual based infectious disease model"'
author:
  - Charlie Whittaker^[Imperial College London], Tom Brewer^[Imperial College London], Adam Howes^[Independent]
output: 
  bookdown::html_document2:
    fig_caption: yes
    number_sections: yes
pkgdown:
  as_is: true
vignette: >
  %\VignetteIndexEntry{blueprint}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
bibliography: REFERENCES.bib
editor_options: 
  markdown: 
    wrap: sentence
---

```{r, include = FALSE}
options(rmarkdown.html_vignette.check_title = FALSE)

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  dpi = 330,
  out.width = "90%"
)

```

```{r}
library(helios)
library(individual)
library(ggplot2)
library(dplyr, warn.conflicts = FALSE)
library(purrr)
theme_set(theme_minimal())
blueprint_colours <- colorRampPalette(c("#00AFFF", "#03113E"))(4)
exemplar_data <- readRDS("./exemplar_simulations.rds")
parameter_sweep_data <- readRDS("./parameter_sweep_data.rds")
```

# Overview {-}

In our [initial report](https://mrc-ide.github.io/helios/articles/blueprint.html) we introduced `helios`: an individual-based modelling framework for exploring the impact that installation of far UVC could have on the transmission and burden of respiratory infections.
This report describes updates made to the modelling framework since that initial report (Section \@ref(changes)).
Additionally, we present a series of analyses evaluating the impact that installation of far UVC in non-household settings could have on the burden.... (Section \@ref(assessing)).

# Major Model Changes {#changes}

Two major updates to the model have been made since the initial report.
These are:

1. Using data from the United States of America (USA) to parameterise all aspects of the model (Section \@ref(usa-data)).
2. Including variation in the propensity for infectious disease transmission (which we call "riskiness") by individual locations in the model (Section \@ref(location)).

## Consistent Use of Data from the USA {#usa-data}

Add some subsections here about the data we now use.
Can basically copy the structure of the first report.

## Location-Specific Variability in "Riskiness" {#location}

Previously, we modelled differences in "riskiness" (i.e. how receptive to onwards transmission it is) between different Setting Types (schools, workplaces, leisure settings and households).
However, we made the simplifying assumption that all Locations with a particular Setting Type (e.g. individual schools) had the same riskiness.
We now explicitly incorporate variation in riskiness between Locations belonging to the same Setting Type.
Below is a mathematical description of this addition and the parameterisation used for the results presented in this report.

### Modelling Variation in Transmission Riskiness Across Locations Belonging to the Same Setting Type

Previously, we modelled the force of infection experienced by individual $i$ in Location $m$ at time $t$ as follows:

$$ \lambda_{i,j,m}(t) = \frac{\beta_{m} I_{j,m}(t)}{N_{j,m}} $$

where $I_m(t)$ are the number of infectious individuals in Location $j$ of Setting Type $m$ at time $t$ , $N_{j,m}$ are the total number of individuals visiting Location $j$ of Setting Type $m$ at time $t$ and $\beta_m$ is a Setting Type-specific (i.e. workplace, school, household, leisure-venue specific) transmissibility parameter that models **on average** how much transmission happens in a particular Setting Type (e.g. workplaces) compared to other Settings Types (e.g. schools).
The total force of infection $\lambda_T$ experienced across all Setting Types is then summed and forms the basis for calculating an individual's probability of infection during one time-step $t$:

$$ P(infection) = 1 - e^{- \lambda_{i,T}t}. $$

Previously, $\beta$ was specific to the Setting Type (i.e. it was different for schools, workplaces, households and leisure settings) but assumed to be the same same for every location of that setting type e.g. all schools had the same $\beta$.

We have now relaxed this assumption.
The updated force of infection term is:

$$ \lambda_{i,j,m}(t) = \frac{\beta_{j,m} I_{j,m}(t)}{N_{j,m}} $$

where:\
$$ \beta_{j,m} = \gamma_{j,m}\beta_{m} $$

and:

$$
\gamma_{j,m} \sim Lognormal(\mu_{m}, \sigma_{m})
$$

i.e. a draw from a Lognormal distribution.
The parameter $\gamma$ controls how risky a particular Location of a specific Setting Type is relative to the **average** for that Setting Type.
For example, $\gamma = 1$ is a setting which is as "risky" as the average location of that Setting Type.
Meanwhile, $\gamma = 2$ would describe a setting that is twice as risky; $\gamma = 0.5$ would describe a setting that is half as risky etc.
Parameterisation and estimation of the parameter $\gamma$ is described further below.

### Parameterising $\gamma$ - Estimating Empirical Variation in Transmission Riskiness Across Locations Belonging to the Same Setting Type

To generate estimates of $\gamma$, we integrated a mathematical model of indoor air quality (as applied to infective virus concentrations) with a well-studied airborne infectious risk model (the Wells-Riley equation).
We then parameterised these models with literature-derived estimates of:

1.  Virus-specific parameters (with SARS-CoV-2 chosen as a case study)

2.  Variation in ventilation rates across Locations belonging to the same Setting Type.

Together, these components enable us to produce estimates of the variation in riskiness for SARS-CoV-2 transmission between different Locations belonging to the same Setting Type.
Below we describe this process.

#### Modelling the Concentration of Infective Virus in an Enclosed Space and Associated Infection Risk

Following the approach of [Blatchley et al, 2024](https://pubs.acs.org/doi/full/10.1021/acs.est.3c03026#), we model the concentration of pathogen in the air in an enclosed space via the following ODE:

$$
\nu \frac{dC(t)}{dt} =  - QC - k_DC \nu + I\pi 
$$

where $v$ is the space volume, $C$ is the infective virus concentration, $t$ is time, $Q$ is the flow rate of air into and out of the space, $k_D$ is the natural decay constant, $I$ is the number of infectious individuals in the space, and $\pi$ is the per capita (infective) virus emission rate.
The closed-form solution to this equation is:

$$
C =  \frac{I\pi}{\alpha \nu}(1 - e^{-\alpha t}) 
$$

where:

$$
\alpha = \frac{Q}{\nu} + k_D
$$

$\frac{Q}{\nu}$ is sometimes referred to as $A$ or the number of hair changes per hour.
$\alpha$ is therefore the number of equivalent air changes per hour taking into account both natural decay of the virus and ventilation driven removal of infective virus.
As $t \rightarrow\infty$, we get the steady state solution, which is the following:

$$
C_{ss} =  \frac{I\pi}{\alpha \nu}
$$

For the purposes of the analyses presented here, we assume the volume of the space is the following: $$
\nu = N D_mH
$$ where $N$ is the number of people occupying the space, $D_m$ is the density of people in the space (i.e. the number of people per m\^2) and $H$ is the height of the space.

We then integrate this estimate of the concentration of infective virus in the room with the Wells-Riley equation, a simple and widely used model for the airbone transmission of infectious diseases.
The Wells-Riley equation takes the following form:

$$
P_{i}(t) =  1 - e^{-r C_{ss}Bt}
$$

where $P_i$ is the probability a person becomes infected conditional on them spending time $t$ in a room with $C_{ss}$ concentration of infective virus, $B$ is the volume rate at which air is breathed in, and $r$ is the risk parameter, the probability that a single inhaled infective virus will initiate an infection.

#### Estimating Variation in Riskiness Across Locations of the Same Setting Type

With the modelling framework to assess risk in place, we carried out a sensitivity analysis to derive reasonable bounds for $\gamma$.
We used the above equations in tandem with estimates of variation in the ventilation rates in different spaces and parameter estimates for SARS-CoV-2 from Blatchley et al (see Table \@ref(tab:1)) to explore how Location riskiness varied whilst varying:

1.  Infection Prevalence (i.e. the number of infectious individuals in the space).
2.  Air Changes Per Hour (considering the minimum and maximum of the ranges provided in Table \@ref(tab:1))
3.  The Time Spent in the Space (ranging from 0 to 8 hours).

Our results show that the ratio of riskiness for the most and least risky locations for each Setting Type are invariant across different infection prevalences and assumptions about the time spent in the space.
We use these ratios as the basis for the Setting Type and Location specific $\gamma_{j,m}$ values used in the modelling analyses presented in the next section.

```{r wells-riley-1, fig.cap="(ref:wells-riley-1)"}

overall_df <- readRDS(paste0(here::here(), "/inst/blueprint_july_wells_riley_infection_risk_variation.rds"))
a <- ggplot(subset(overall_df, infection_prevalence == "1% Prev."),
       aes(x = as.numeric(time), y = prob_inf, col = factor(ACPH))) +
  geom_line() +
  geom_point() +
  facet_grid(. ~ setting_type, scales = "free_y") +
  theme_bw() +
  labs(x = "Time (Hours)", y = "Prob. Infected\n(Wells Riley)",
       col = "Air Changes\nPer Hour",
       title = "Infection Risk Over Time for Each Setting Type Across\nACPH Range")

overall_df2 <- overall_df %>%
  filter(time != 0) %>%
  group_by(time, infection_prevalence, setting_type) %>%
  summarise(ratio = prob_inf[airchanges_per_hour == min(airchanges_per_hour)]/
                    prob_inf[airchanges_per_hour == max(airchanges_per_hour)])

b <- ggplot(overall_df2, aes(x = as.numeric(time), y = ratio, col = setting_type)) +
  geom_line() +
  geom_point() +
  facet_grid(. ~ infection_prevalence) +
  lims(y = c(0, 10)) +
  theme_bw() +
  labs(x = "Time (Hours)", y = "Ratio of\nInfection Risk",
       col = "Air Changes\nPer Hour",
       title = "Ratio of Infection Risk in Most vs Least Ventilated Locations\nof Each Setting Type")

c <- cowplot::plot_grid(a, b, nrow = 2, labels = c("A", "B"))
c
```

+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Parameter       | Value Used                          | Description                                                                                     | Source                                                                                                                                                                              |
+=================+=====================================+=================================================================================================+=====================================================================================================================================================================================+
| $\pi$           | 27 viruses per person per hour      | Rates of infective virus emission from infected individuals.                                    | [Blatchley et al, 2024](https://pubs.acs.org/doi/full/10.1021/acs.est.3c03026#) & [Buonanno et al, 2020](https://www.sciencedirect.com/science/article/pii/S0160412020320675#f0020) |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| $D_{school}$    | 30 per 100m\^2                      | Assumed density of individuals in schools                                                       | ANSI/ASHRAE Standard 62.1-2022 Table 6.1                                                                                                                                            |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| $A_{school}$    | 0.1-2.9 air changes per hour (ACPH) | Range of ACPH considered for schools.                                                           | [Corsi et al, 2006](https://corsiaq.com/reports-etc/) - Section 3.1                                                                                                                 |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| $D_{workplace}$ | 10 per 100m\^2                      | Assumed density of individuals in workplaces                                                    | ANSI/ASHRAE Standard 62.1-2022 Table 6.1                                                                                                                                            |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| $A_{workplace}$ | 0.22-4.84 ACPH                      | Range of ACPH considered for workplaces.                                                        | [Corsi et al, 2006](https://corsiaq.com/reports-etc/) - Section 3.1                                                                                                                 |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| $D_{household}$ | 5 per 100m\^2                       | Density of individuals in households                                                            | Assumed                                                                                                                                                                             |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| $A_{household}$ | 0.21-1.48 ACPH                      | Range of ACPH considered for households.                                                        | [Corsi et al, 2006](https://corsiaq.com/reports-etc/) - Section 3.1                                                                                                                 |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| $D_{leisure}$   | 50 per 100m\^2                      | Density of individuals in leisure settings                                                      | ANSI/ASHRAE Standard 62.1-2022 Table 6.1                                                                                                                                            |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| $A_{leisure}$   | 0.22-4.84 ACPH                      | Range of ACPH considered for leisure locations.                                                 | [Corsi et al, 2006](https://corsiaq.com/reports-etc/) - Section 3.1                                                                                                                 |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| $k_D$           | 0.64                                | Natural decay constant for SARS-CoV-2 in aerosols                                               | [Blatchley et al, 2024](https://pubs.acs.org/doi/full/10.1021/acs.est.3c03026#) & [van Doremalen et al, 2020](https://www.nejm.org/doi/full/10.1056/NEJMc2004973)                   |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| $H$             | 2.5m                                | Height of the space                                                                             | Assumed                                                                                                                                                                             |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| $B$             | 0.45 m\^3 per hour                  | Volume breathing rate assumes 15 breaths per minute and 500ml tidal volume = 0.45m\^3 per hour. | <https://www.verywellhealth.com/tidal-volume-5090250#>                                                                                                                              |
|                 |                                     |                                                                                                 |                                                                                                                                                                                     |
|                 |                                     |                                                                                                 | &                                                                                                                                                                                   |
|                 |                                     |                                                                                                 |                                                                                                                                                                                     |
|                 |                                     |                                                                                                 | <https://my.clevelandclinic.org/health/articles/10881-vital-signs>                                                                                                                  |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| $r$             | 1.37 × 10\^-2                       | The probability that a single inhaled infective virus will initiate an infection.               | [Blatchley et al, 2024](https://pubs.acs.org/doi/full/10.1021/acs.est.3c03026#) & [Killingley et al, 2022](https://www.nature.com/articles/s41591-022-01780-9)                      |
+-----------------+-------------------------------------+-------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

: Table 1: Parameter Estimates Used to Calculate Variation in Riskiness Across Locations Belonging to the Same Setting Type

# Assessing how various far UVC parameters shape another outcome {#assessing}

We considered two pathogen archetypes, SARS-CoV-2 and influenza.
The properties of SARS-CoV-2 were as follows.
The properties of influenze were as follows.
For each pathogen archetype, we considered the effect of far UVC efficacy and far UVC coverage on another outcome.
We varied far UVC efficacy in the following range.
We varied far UVC coverage in the following range with the following settings.
The results are presented in Figure \@ref(fig:placeholder-1) and Figure \@ref(fig:placeholder-2).

```{r placeholder-1, fig.cap="(ref:placeholder-1)"}
data.frame(x = 1:5, y = 1:5) |>
  ggplot(aes(x = x, y = y)) +
  geom_point() +
  theme_minimal()
```

(ref:placeholder-1) Placeholder one.

```{r placeholder-2, fig.cap="(ref:placeholder-2)"}
data.frame(x = 1:5, y = 1:5) |>
  ggplot(aes(x = x, y = y)) +
  geom_point() +
  theme_minimal()
```

(ref:placeholder-2) Placeholder two.

# Bibliography {.unnumbered}
